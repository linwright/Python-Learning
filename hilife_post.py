# -*- coding: utf-8 -*-
"""
Created on Wed Jul  3 14:51:12 2019

@author: M06272
"""
#omport package
import time #時間模組
import random #隨機數模組
import pandas as pd
from pandas.core.frame import DataFrame #處理dataframe 
import requests
from bs4 import BeautifulSoup as bs
import re
import numpy as np
import sys
sys.path.append('D:\python') #導向自訂函式庫路徑
import db_fun #自訂函式庫


"""
hilife爬蟲邏輯：
1.需先載入到初始查詢頁面(預設篩選條件為台北市/中正區)[GET]
2.抓取各縣市下的地區資料[POST]
3.取得aspx相關動態參數訊，並根據條件變更回傳動態參數[POST]

"""

#初始連線設定
url='http://www.hilife.com.tw/storeInquiry_street.aspx'
    
header={
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',
        'Accept-Encoding': 'gzip, deflate',
        'Accept-Language': 'zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7',
        'Cache-Control': 'max-age=0',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Host': 'www.hilife.com.tw',
        'Origin': 'http://www.hilife.com.tw',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://www.hilife.com.tw/storeInquiry_street.aspx',
        'Upgrade-Insecure-Requests': '1',
        'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'   
        }

session_requests = requests.session() #保持相同連線
webdata = session_requests.get(url, headers = dict(referer = url)) #先獲取各縣市資訊及台北市區域資訊
soup = bs(webdata.text, 'html.parser')
cityselect=soup.find('select',id='CITY')
city=cityselect.text.strip().split('\n')
areaselect=soup.find('select',id='AREA')
area=areaselect.text.strip().strip().split('\n')
sertotal=[]
arealist= DataFrame(columns={'city','area'})

#記錄城市+區域參數
for ci in city:
    searchmap={
        '__EVENTTARGET': 'CITY',
        '__EVENTARGUMENT': '',
        '__LASTFOCUS':'', 
        '__VIEWSTATE': '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guekvuato+W6lyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot68yN+iZnyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot68yN+iZn1Q8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2F0bS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+aPkOasvuacjeWLmScgLz5YPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF90c2NjLmdpZicgd2lkdGg9JzI1JyBoZWlnaHQ9JzI1JyB0aXRsZT0n5oKg6YGK5Y2h5Yqg5YC8JyAvPlQ8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2NvZmZlZS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+WSluWVoeapnycgLz5XPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF9waWMuZ2lmJyB3aWR0aD0nMjUnIGhlaWdodD0nMjUnIHRpdGxlPSfnm7jniYfmspbmtJfmqZ8nIC8+AGA8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2xpZmVFdC5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J0xpZmUtRVQo6LO856WoKeacjeWLmScgLz5TPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF9lY2FyZC5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+S4gOWNoemAmicgLz4LMDItMjgxNjM4NDFkAgkPZBYCZg8VDAQyNzU1D+WMl+W4guWjq+aFtuW6lyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot683NeiZnyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot683NeiZn1Q8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2F0bS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+aPkOasvuacjeWLmScgLz5YPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF90c2NjLmdpZicgd2lkdGg9JzI1JyBoZWlnaHQ9JzI1JyB0aXRsZT0n5oKg6YGK5Y2h5Yqg5YC8JyAv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',
        '__VIEWSTATEGENERATOR': 'B77476FC',
        '__EVENTVALIDATION': '/wEdACFF6PLj3jmE7CCvW5pGMR752ryV+Ed5kWYedGp5zjHs3Neeeo/9TTvNTdElW+hiVA25mZnLEQUYPOZFLnuVu9jOT+Zq1/xceVgC7GxWRM+A8tOS3xZBjlhgzlx5UN3H3D0UrdtoyeScvRqxFL8L3gGKRyCJu029oItLX7X6c7SW7C7IVzuAeZ6t9kFMeOQus7MtrV7YeOXrlOP8inI96UkaJEU7Ro3FtK29+B+NamR2j4qInKVwJ4+JD3cjWm5buZdnOhT/ISzrljaf+F9GnVjm4dGchVglf1PxMMHl7EEoLjs20TZ856RDCGXvzK/6J+tEFp7zDvFTYGoeHtuHy+YF/IoR/CRFBAaEkys48FIAUCSUKnxACPyW6Ar2guIADjOqYue7v4fhV1jIq65P/lwanoaJpIsboCbjakbTYnqK8BLngMayrRehyT58dmj3SbxfwQwVGVzZwAgwD6LzlOgZm92PADtlvqBaVxhs61QhgGa+yOVXabtBPFP0ce3bwL9kyru+0js+0yHcmVl8I4kvxPR4R0hNd9cQKnFNppipjIk6xNzdYROgF8RRc2LzPIbxIF93IS2uuvwub57vjv4BHpi7KRXMxAcvbi+xeCOWf5QnLBf1Oja22DoYzoFWsqHCkgsHJuU44HX5NQChgqJJES/kXuMA0GFWdxWVcTjLsXS99GqqMytAf5RLr4X94ZLqtFyHjhhpynbWy0UnoH9IFIARxune2N+vaJw7MzClgQ==',
        'CITY': ci
    } #設定查詢參數
    result = session_requests.post(url, data = searchmap, headers = header)
    response= bs(result.text,'html.parser')
    areaselect=response.find('select',id='AREA')
    area=areaselect.text.strip().split('\n')
    
    for ai in area:
        item={"city":[ci],
              "area":[ai]}
        item=DataFrame(item)
        arealist=pd.concat([arealist,item], ignore_index=True)


#開始抓取店鋪資訊
#ˊ注意參數回傳問題!跨城市需使用'__EVENTTARGET': 'CITY'回傳，反之則用__EVENTTARGET': 'AREA'回傳
j=0
while j<len(arealist):       
     
        if j>0 and arealist["city"][j]!=arealist["city"][j-1]: 
             searchmap={
             '__EVENTTARGET': 'CITY',
             '__EVENTARGUMENT': '',
             '__LASTFOCUS':'', 
             '__VIEWSTATE': __VIEWSTATE,
             '__VIEWSTATEGENERATOR': 'B77476FC',
             '__EVENTVALIDATION': __EVENTVALIDATION,
             'CITY': arealist["city"][j]
             } #設定查詢參數     
        elif j==0: #設定初始參數回傳給網站查詢
            searchmap={
            '__EVENTTARGET': 'AREA',
            '__EVENTARGUMENT': '',
            '__LASTFOCUS':'', 
            '__VIEWSTATE': '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guekvuato+W6lyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot68yN+iZnyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot68yN+iZn1Q8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2F0bS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+aPkOasvuacjeWLmScgLz5YPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF90c2NjLmdpZicgd2lkdGg9JzI1JyBoZWlnaHQ9JzI1JyB0aXRsZT0n5oKg6YGK5Y2h5Yqg5YC8JyAvPlQ8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2NvZmZlZS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+WSluWVoeapnycgLz5XPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF9waWMuZ2lmJyB3aWR0aD0nMjUnIGhlaWdodD0nMjUnIHRpdGxlPSfnm7jniYfmspbmtJfmqZ8nIC8+AGA8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2xpZmVFdC5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J0xpZmUtRVQo6LO856WoKeacjeWLmScgLz5TPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF9lY2FyZC5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+S4gOWNoemAmicgLz4LMDItMjgxNjM4NDFkAgkPZBYCZg8VDAQyNzU1D+WMl+W4guWjq+aFtuW6lyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot683NeiZnyMxMTHlj7DljJfluILlo6vmnpfljYDnpL7mraPot683NeiZn1Q8aW1nIHNyYz0naW1hZ2VzL2ljb24vbWFya2VkX2F0bS5naWYnIHdpZHRoPScyNScgaGVpZ2h0PScyNScgdGl0bGU9J+aPkOasvuacjeWLmScgLz5YPGltZyBzcmM9J2ltYWdlcy9pY29uL21hcmtlZF90c2NjLmdpZicgd2lkdGg9JzI1JyBoZWlnaHQ9JzI1JyB0aXRsZT0n5oKg6YGK5Y2h5Yqg5YC8JyAv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',
            '__VIEWSTATEGENERATOR': 'B77476FC',
            '__EVENTVALIDATION': '/wEdACFF6PLj3jmE7CCvW5pGMR752ryV+Ed5kWYedGp5zjHs3Neeeo/9TTvNTdElW+hiVA25mZnLEQUYPOZFLnuVu9jOT+Zq1/xceVgC7GxWRM+A8tOS3xZBjlhgzlx5UN3H3D0UrdtoyeScvRqxFL8L3gGKRyCJu029oItLX7X6c7SW7C7IVzuAeZ6t9kFMeOQus7MtrV7YeOXrlOP8inI96UkaJEU7Ro3FtK29+B+NamR2j4qInKVwJ4+JD3cjWm5buZdnOhT/ISzrljaf+F9GnVjm4dGchVglf1PxMMHl7EEoLjs20TZ856RDCGXvzK/6J+tEFp7zDvFTYGoeHtuHy+YF/IoR/CRFBAaEkys48FIAUCSUKnxACPyW6Ar2guIADjOqYue7v4fhV1jIq65P/lwanoaJpIsboCbjakbTYnqK8BLngMayrRehyT58dmj3SbxfwQwVGVzZwAgwD6LzlOgZm92PADtlvqBaVxhs61QhgGa+yOVXabtBPFP0ce3bwL9kyru+0js+0yHcmVl8I4kvxPR4R0hNd9cQKnFNppipjIk6xNzdYROgF8RRc2LzPIbxIF93IS2uuvwub57vjv4BHpi7KRXMxAcvbi+xeCOWf5QnLBf1Oja22DoYzoFWsqHCkgsHJuU44HX5NQChgqJJES/kXuMA0GFWdxWVcTjLsXS99GqqMytAf5RLr4X94ZLqtFyHjhhpynbWy0UnoH9IFIARxune2N+vaJw7MzClgQ==',
            'CITY': '台北市',
            'AREA': '中正區'
            }
        else: #同縣市下地區更替
            searchmap={
             '__EVENTTARGET': 'AREA',
             '__EVENTARGUMENT': '',
             '__LASTFOCUS':'', 
             '__VIEWSTATE': __VIEWSTATE,
             '__VIEWSTATEGENERATOR': 'B77476FC',
             '__EVENTVALIDATION': __EVENTVALIDATION,
             'CITY': arealist["city"][j],
             'AREA': arealist["area"][j]
             } #設定查詢參數
        result = session_requests.post(url, data = searchmap, headers = header) 
            
        __VIEWSTATE=re.search('id="__VIEWSTATE" value="(.*?)"',result.text).group(1)
        __EVENTVALIDATION= re.search('id="__EVENTVALIDATION" value="(.*?)"',result.text).group(1)


        result = session_requests.post(url, data = searchmap, headers = header)
        response= bs(result.text,'html.parser')
        a_tags = response.find('table')
        a=a_tags.text
        c1=1
        i=0
        a=a.strip()
        string=''
        tspace=[]
        while c1!=0:
            string=string+'\n'
            tspace.append(string)
            c1=a.count(tspace[i])
            i+=1
        while i>0:
            a=a.replace(tspace[i-1], ';')  
            i-=1
            #資料字串轉換為dataframe處理---------------------------------------------
        ser=a.split(';')
        sertotal=sertotal+ser 
        j+=1
        time.sleep(random.random()*3)#設置隨機時間訪問
        
session_requests.close() #瀏覽器連線斷開

#利用np將list轉為陣列後，變更維度組數存入DataFrame中

arr1=np.array(sertotal).reshape(int(np.size(sertotal)/4),4)
df=DataFrame(arr1).rename(columns={0:"store_no",1:"store_name",2:"addr",3:"tel"})    
        
#############DB連線參數設定################

inserttable='HILIFE_STORE'

#執行函式，轉入資料
db_fun.truncatetable(inserttable)
db_fun.intotable(df,inserttable)
            
        




